<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="index_files/styles.css">
</head>
<body id="body" class="optionsBody">

<h1 class="optionsTitle" id="title">HTML Table</h1>

<table class="optionsTable" id="table" data-step-index="0">
</table>

<button class="nextButton" onclick="nextPage()">Next</button>

<script>
    var stages = new Map([

        ["Plant Group", ["tree","grass","shrub","forb","succulent"]],
        ["Leaf Type", ["simple","lobed","pinnate","compound/deeply divided","blade"]],
        ["Leaf Arrangement", ["alternate","opposite","bundled","whorled","rosette"]],
        ["Growth Form", ["prostrate","decumbent","ascending","erect","mat","clump-forming","rosette","vine"]],
        ["Flower Color", ["white","yellow","red","orange","blue","purple","green","pink"]],
        ["Flower Symetry", ["radial","bilateral","asymmetrical"]]

        ]);

    var keys = Array.from(stages.keys());
    var stageIndex = -1;
    var table = document.getElementById("table");
    var query = "";

    document.getElementById("body").onload = nextPage();

    function nextPage()
    {
      if(stageIndex > -1)
        for(i = 0; i < table.rows.length; i++)
          if(table.rows[i].cells[1].dataset.selected == "true")
            query += (stages.get(keys[stageIndex])[i] + ",");

      stageIndex++;

      if(stageIndex < keys.length)
      {
        document.getElementById("title").innerHTML = keys[stageIndex];
        table.innerHTML = "";
        generateTable(stages.get(keys[stageIndex]), table);
      }
      else
      {
        if(query.charAt(query.length-1) == ",")
          query = query.slice(0,query.length-1);

        window.location.href="results.html?q=" + query;
      }
    }
    function generateTable(attribs, table)
    {
        // For testing, need an outer method to handle moving from table to table
        //attribs = stages.get("Plant Group");

        for(i = 0; i < attribs.length; i++)
        {
            var row = table.insertRow(i);
            row.className="optionsRow";
            row.insertCell(0).innerHTML = '<img src="./index_files/img/' + attribs[i] +'.png" height="75" width="75">';
            row.insertCell(1).innerHTML = capitalize(attribs[i]);

            // filesystem doesnt allow "/" in file name
            if(attribs[i] == "compound/deeply divided")
              row.cells[0].innerHTML = '<img src="./index_files/img/' + "compound" +'.png" height="75" width="75">';

            table.rows[i].cells[0].className="optionsRow";
            table.rows[i].cells[1].className="optionsRow";
            table.rows[i].cells[0].width = 50;
            table.rows[i].cells[1].addEventListener("click", selected, false);

            // for some uncomprehensable reason you cant have boolean data attributes, HOWEVER
            //  dataset.selected = false; will *IMPLICITLY* convert false to "false" AND
            // if("false") will implicitly convert "false" to false, but not !"false" to true, SO
            // dataset.selected == !dataset.selected. This took like an hour to debug
            table.rows[i].cells[1].dataset.selected = "false";
            table.rows[i].cells[1].style.background="white";
        }
    }

    function selected(event)
    {
        if(event.target.dataset.selected == "false")
        {
            event.target.style.background="LightGreen";
            event.target.dataset.selected = "true";
        }
        else
        {
            event.target.style.background="White";
            event.target.dataset.selected = "false";
        }


    }

    function capitalize(string)
    {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }

</script>

</body>
</html>
